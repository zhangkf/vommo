<!DOCTYPE html> 
<html> 
	<head> 
	<title>Vommo</title> 

	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />

    <link href="http://demo.mobiscroll.com/css/mobiscroll-1.5.2.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>

    <script src="http://demo.mobiscroll.com/js/mobiscroll-1.5.2.js" type="text/javascript"></script>

</head> 
<body> 

<!-- Start of first page -->
<div data-role="page" id="foo">

	<div data-role="header">
		<h1>Vommo</h1>
	</div><!-- /header -->

	<div data-role="content">	

<div data-role="fieldcontain">
    <label for="cause">Cause:</label>
    <input type="text" name="cause" id="cause" value=""  onblur="buildHref();"/>
</div>	
<div data-role="fieldcontain">
    <label for="from">From:</label>
	<input type="text" name="from" id="from" class="mobiscroll" onblur="buildHref();"/>
</div>	
<div data-role="fieldcontain">
    <label for="to">To:</label>
	<input type="text" name="to" id="to" class="mobiscroll" onblur="buildHref();"/>
</div>	

<fieldset data-role="controlgroup">
	<legend>Choose leave type:</legend>
     	<input type="radio" name="leave-type" id="leave-type-1" value="Annual Leave" checked="checked" onclick="buildHref();"/>
     	<label for="leave-type-1">Annual Leave</label>

     	<input type="radio" name="leave-type" id="leave-type-2" value="Sick Leave"  onclick="buildHref();"/>
     	<label for="leave-type-2">Sick Leave</label>
</fieldset>

<div data-role="fieldcontain">
    <label for="sendto">Send To:</label>
    <input type="text" name="sendto" id="sendto" value=""  onblur="buildHref();"/>
</div>	
<div data-role="fieldcontain">
    <fieldset data-role="controlgroup">
	   <legend>Copy to:</legend>
	   <input type="checkbox" name="copyto" id="checkbox-1" class="custom" value="twchina" onclick="buildHref();"/>
	   <label for="checkbox-1">TWChina</label>
	   <input type="checkbox" name="copyto" id="checkbox-2" class="custom" value="beijingoffice" onclick="buildHref();"/>
	   <label for="checkbox-2">BeijingOffice</label>
	   <input type="checkbox" name="copyto" id="checkbox-3" class="custom" value="xianoffice" onclick="buildHref();"/>
	   <label for="checkbox-3">XianOffice</label>
	   <input type="checkbox" name="copyto" id="checkbox-4" class="custom" value="china_time_off" checked="checked" disabled="disabled" />
	   <label for="checkbox-4">china_time_off</label>
    </fieldset>
</div>
<div data-role="fieldcontain">
	<a href="mailto:china_time_off@thoughtworks.com?subject=I would like to take leave." id="sendButton" data-role="button">Send Vacation Request</a>
</div>
	</div><!-- /content -->

	</body>
	
	<script>
	$(document).ready(function () {
        $('#from').scroller();
		$('#to').scroller();
		
		
    });
    
    function collectParameters() {
    	var status = {};
    	status.cause = $("#cause").val();
    	status.from  = $("#from").val();
    	status.to = $("#to").val();
    	status.leaveType = $("input[name='leave-type']:checked").val();
    	status.sendTo = $("#sendto").val();
    	status.copyTo = new Array();
    	$("input[name='copyto']:checked").each(function(){
    		$(this).val() && status.copyTo.push($(this).val());
    	});
    	//console.debug("status", status);
    	return status;	
    }
    
    function buildHref(){
    	var status = collectParameters();
    	var mailTo = buildMailTo(status);
		var subject = buildSubject(status);
		console.debug(mailTo+subject);
		$("#sendButton").attr("href", mailTo+subject);
		
    }
    
    function buildSubject(status) {
    	var subject = ["?subject=I would like to take", status.leaveType, "from", status.from, "to", status.to].join(" ");
    	return subject;
    }
    
    function buildReceivers(status) {
    	var receivers = new Array();
    	if(status.sendTo){
    		receivers.push(status.sendTo);
    	}
    	for (var i = 0; i < status.copyTo.length; i++) {
    		if(vommo.statics[status.copyTo[i]])
    		receivers.push(vommo.statics[status.copyTo[i]]);
    	}
    	
    	return receivers.join();
    }
    
    
    function buildMailTo(status) {
    	var mailTo = ["mailto:", buildReceivers(status)].join("");
		return mailTo;    	
    }
    
    var vommo = {};
    vommo.statics = {
    	"twchina" : "twchina@thoughtworks.com",
    	"beijingoffice" : "beijingoffice@thoughtworks.com",
    	"xianoffice" : "xianoffice@thoughtworks.com",
    	"china_time_off" : "china_time_off@thoughtworks.com"
    };
        
	</script>

</html>