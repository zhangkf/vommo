<!DOCTYPE html> 
<html> 
	<head> 
	<title>Vommo</title> 

	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />

    <link href="http://demo.mobiscroll.com/css/mobiscroll-1.5.2.css" rel="stylesheet" type="text/css" />
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script>
		$(document).bind("mobileinit", function() {
		      $.mobile.page.prototype.options.addBackBtn = true;
		 });
	</script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>

    <script src="http://demo.mobiscroll.com/js/mobiscroll-1.5.2.js" type="text/javascript"></script>

</head> 
<body> 

<!-- Start of first page -->
<div data-role="page" id="foo">

	<div data-role="header">
		<h1>Vommo</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<div class="content-primary">	
		
		<ul data-role="listview">
					<li>
						<h3>Leave Type</h3>
						<p id="leave-type-comment">Annual Leave</p>

						<ul>
							<li>
							<div data-role="fieldcontain">
							
							<fieldset data-role="controlgroup">
								<legend>Choose leave type:</legend>
							     	<input type="radio" name="leave-type" id="leave-type-1" value="Annual Leave" checked="checked" onclick="buildHref();"/>
							     	<label for="leave-type-1">Annual Leave</label>

							     	<input type="radio" name="leave-type" id="leave-type-2" value="Sick Leave"  onclick="buildHref();"/>
							     	<label for="leave-type-2">Sick Leave</label>
							</fieldset>
							
						</div>
						</li>
						</ul>
					</li>
					<li>
						<h3>Leave Period</h3>
						<p id="from-to-comment">tomorrow</p>

						<ul>
							<li>
							<div data-role="fieldcontain">
							    <label for="from">Vacation start:</label>
								<input type="text" name="from" id="from" class="mobiscroll" onblur="buildHref();"/>
								    <fieldset data-role="controlgroup" data-type="horizontal" >
								         	<input type="radio" name="from-am-pm" id="from-am" value="AM" onclick="buildHref();" />
								         	<label for="from-am">AM</label>

								         	<input type="radio" name="from-am-pm" id="from-pm" value="PM" onclick="buildHref();" />
								         	<label for="from-pm">PM</label>
								    </fieldset>
							</div>
							</li>
							<li>	
							<div data-role="fieldcontain">
							    <label for="to">Vacation end:</label>
								<input type="text" name="to" id="to" class="mobiscroll" onblur="buildHref();"/>
								<fieldset data-role="controlgroup" data-type="horizontal" >
							         	<input type="radio" name="to-am-pm" id="to-am" value="AM" onclick="buildHref();" />
							         	<label for="to-am">AM</label>

							         	<input type="radio" name="to-am-pm" id="to-pm" value="PM" onclick="buildHref();" />
							         	<label for="to-pm">PM</label>
							    </fieldset>
							</div>
							</li>
						</ul>
					</li>
					
					<li>
						<h3>Send To</h3>
						<p id="send-to-comment">Default: china_time_off</p>

						<ul>
								<li>
								<div data-role="fieldcontain">
								    <fieldset data-role="controlgroup">
									   <legend>Send to:</legend>
									   <input type="checkbox" name="copyto" id="checkbox-1" class="custom" value="twchina" onclick="buildHref();"/>
									   <label for="checkbox-1">TWChina</label>
									   <input type="checkbox" name="copyto" id="checkbox-2" class="custom" value="beijingoffice" onclick="buildHref();"/>
									   <label for="checkbox-2">BeijingOffice</label>
									   <input type="checkbox" name="copyto" id="checkbox-3" class="custom" value="xianoffice" onclick="buildHref();"/>
									   <label for="checkbox-3">XianOffice</label>
									   <input type="checkbox" name="copyto" id="checkbox-4" class="custom" value="china_time_off" checked="checked" disabled="disabled" />
									   <label for="checkbox-4">china_time_off</label>
								    </fieldset>
								</div>
								
								
							</li>
							
								<li>
									<div data-role="fieldcontain">
									    <label for="sendto">Also send to: (optional)</label>
									    <input type="email" name="sendto" id="sendto" value=""  onblur="buildHref();"/>
									</div>	
									</li>				
						</ul>
					</li>
					<li>
						<h3>Leave Cause</h3>
						<p>Input your leave cause here.(optional)</p>

						<ul>
							<li>
								<div data-role="fieldcontain">
								    <label for="cause">Why vacation: (optional)</label>
								    <input type="text" name="cause" id="cause" value=""  onblur="buildHref();"/>
								</div>	
							</li>
											
						</ul>
					</li>
				</ul>
</div>





<div data-role="fieldcontain">
	<a href="mailto:china_time_off@thoughtworks.com?subject=I would like to take leave." id="sendButton" data-role="button">Send Vacation Request</a>
</div>
</div><!-- /content -->

</body>
	
<script>
	function isApple(){
    		var ua = navigator.userAgent;
    		return ua.match(/iPhone/i) || ua.match(/iPod/i) || ua.match(/iPad/i);
    	}
    	
	$(document).ready(function(){
		$('#from').scroller({mode: isApple()? 'scroller' : "clickpick"});
		$('#to').scroller({mode: isApple()? 'scroller' : "clickpick"});
	});
	
	function changeListComment(status){
		$("#leave-type-comment").text(status.leaveType);
		if(status.from && status.to) $("#from-to-comment").text("from "+status.from + (status.fromAMPM? " "+status.fromAMPM : "") +" to "+status.to+" "+(status.toAMPM? " "+status.toAMPM : ""));
		if(status.from && !status.to) $("#from-to-comment").text("on "+status.from+ (status.fromAMPM? " "+status.fromAMPM : ""));
		if(!status.from && status.to) $("#from-to-comment").text("on "+status.to+ (status.toAMPM? " "+status.toAMPM : ""));
		if(!status.from && !status.to) $("#from-to-comment").text("tomorrow"+(status.fromAMPM? " "+status.fromAMPM : ""));
	}
    
    function collectParameters() {
    	var status = {};
    	
		status.leaveType = $("input[name='leave-type']:checked").val();
		status.from  = $("#from").val();
    	status.to = $("#to").val();
		status.fromAMPM = $("input[name='from-am-pm']:checked").val();
		status.toAMPM = $("input[name='to-am-pm']:checked").val();		
		status.cause = $("#cause").val();
    	status.sendTo = $("#sendto").val();
    	status.copyTo = new Array();
    	$("input[name='copyto']:checked").each(function(){
    		$(this).val() && status.copyTo.push($(this).val());
    	});
    	//console.debug("status", status);
		changeListComment(status);
    	return status;	
    }
    
    function buildHref(){
    	var status = collectParameters();
    	var mailTo = buildMailTo(status);
		var subject = buildSubject(status);
		//console.debug(mailTo+subject);
		$("#sendButton").attr("href", mailTo+subject);
		
    }
    
    function buildSubject(status) {
    	return ["?subject=I would like to take", $("#leave-type-comment").text(), $("#from-to-comment").text()].join(" ");
    }
    
    function buildReceivers(status) {
    	var receivers = new Array();
    	if(status.sendTo){
    		receivers.push(status.sendTo);
    	}
    	for (var i = 0; i < status.copyTo.length; i++) {
    		if(vommo.statics[status.copyTo[i]])
    		receivers.push(vommo.statics[status.copyTo[i]]);
    	}
    	
    	return receivers.join();
    }
    
    
    function buildMailTo(status) {
    	return ["mailto:", buildReceivers(status)].join("");    	
    }
    
    var vommo = {};
    vommo.statics = {
    	"twchina" : "twchina@thoughtworks.com",
    	"beijingoffice" : "beijingoffice@thoughtworks.com",
    	"xianoffice" : "xianoffice@thoughtworks.com",
    	"china_time_off" : "china_time_off@thoughtworks.com"
    };
        
	</script>

</html>